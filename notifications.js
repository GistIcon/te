(function () {if (KXL && KXL.i18n && KXL.i18n.addLocales) {KXL.i18n.addLocales({"notifications.cta.view":"View","notifications.cta.play":"Play now","notifications.cta.getRevenge":"Get Revenge - Play Now","notifications.cta.joinConversation":"Join the conversation.","notifications.msg.nowfriends":"and you are now friends!","notifications.msg.postedOnWall":"posted on your wall:","notifications.empty":"Empty","notifications.title":"Notifications","notifications.title.achievements.avatar":"You completed the Update Avatar Task. Don't forget to redeem your prize!","notifications.title.achievements.bookmarkForumThread":"You completed the Bookmark a Forum Thread Task. Don't forget to redeem your prize!","notifications.title.achievements.confirmEmail":"You completed the Verify Your Email Task. Don't forget to redeem your prize!","notifications.title.achievements.playerGuide":"You completed the Visit Player Guide Task. Don't forget to redeem your prize!","notifications.title.achievements.register":"You completed the Register Your Account Task. Don't forget to redeem your prize!","notifications.title.achievements.reminder":"Don't forget to complete a Task to win an epic in-game reward.","notifications.title.achievements.threeDays":"You completed the Return 3 Days in a Row Task. Don't forget to redeem your prize!","notifications.title.achievements.unknown":"Unknown Achievement Type","notifications.title.urgent":"You have been attacked","notifications.title.gift-sent":"You received a gift","notifications.settings.label":"Settings","notifications.settings.showInboxMessages":"Show inbox messages","notifications.settings.showGroupNotifications":"Show Group notifications","notifications.settings.showWallPosts":"Show Wall posts","notifications.settings.showUpdatesToForumPosts":"Show updates to forum posts I follow","notifications.settings.showAttackNotifications":"Show attack notifications","notifications.settings.showGiftNotifications":"Show gift notifications","notifications.settings.showGameInviteNotifications":"Show game invites","notifications.settings.showGameUpdateNotifications":"Show game updates","notifications.settings.showUpdatesToForumPostsNotifications":"Show forum replies","notifications.settings.showForumUpdatesToBookmarkedThread":"Show forum replies to bookmarked discussions","notifications.settings.showForumUpdatesToCreatedThread":"Show forum replies to discussions I created","notifications.settings.showForumUpdatesToRepliedThread":"Show forum replies to discussions I am in","notifications.settings.showForumUpdatesToQuotedThread":"Show forum replies that quote me","notifications.settings.showForumUpdatesToVotedThread":"Show likes and dislikes of my forum replies","notifications.clear":"clear all notifications","group.member.invite.notification.accept":"Accept","group.member.invite.notification.reject":"Reject","group.browse.notification.cta":"Browse Groups","notifications.gift.claimGift":"Claim Gift","notifications.group.member.added.msg":"has been added to the %{group} Group.","notifications.group.member.promoted.msg":"has been promoted to the rank %{rank} in the %{group} Group.","notifications.group.member.demoted.msg":"has been demoted to the rank %{rank} in the %{group} Group.","notifications.group.member.removed.msg":"has been booted from the %{group} Group.","notifications.group.discussion.added.msg":"created a new Discussion in %{group} Group.","notifications.group.discussion.added.cta":"Join the conversation.","notifications.group.meta.changed.title":"Group Information Changed","notifications.group.meta.changed.msg":"The %{meta} has been changed in the %{group} Group.","notifications.group.meta.changed.attribute.title":"title","notifications.group.member.left.msg":"has left the %{group} Group.","notifications.group.post.liked.msg":"liked your post in the %{group} Group.","notifications.group.comment.added.msg":"commented on your post in %{group} Group.","notifications.group.invite.msg":"invited you to join the %{group} Group.","notifications.group.applicant.added.msg":"has applied to join the  %{group} Group.","notifications.group.applicant.accepted.title":"Applicant Accepted","notifications.group.applicant.accepted.msg":"You were accepted into the %{group} Group.","notifications.group.delete.title":"Group Deleted","notifications.group.delete.msg":"The %{group} Group has been deleted.","notifications.group.discovery.viewGroup":"View Group","header.notification.invite.invalid.ok.btn":"Ok","header.notification.invite.invalid.title":"Oops","header.notification.invite.invalid.message":"This invite is no longer valid."});}}());

(function () {var head = document.getElementsByTagName("head")[0];var style = document.createElement("style");style.type = "text/css";style.innerHTML = ".kx-sidebar-content-region.notifications .kx-ribbon-region>div{padding:10px 13px 14px;margin-bottom:8px}.kx-sidebar-content-region.notifications .kx-ribbon-region .kx-notifications-settings-item-container{padding:2px}.kx-sidebar-content-region.notifications .kx-ribbon-region .kx-chat-setting-group-label{text-transform:uppercase;font-size:12px;background:-webkit-linear-gradient(#eee,#333);-webkit-background-clip:text;-webkit-text-fill-color:transparent;color:#aaa;line-height:100%}.kx-sidebar-content-region.notifications .kx-ribbon-region .kx-notifications-settings-container .kx-notifications-settings-item-label{text-transform:uppercase;font-size:11px;color:#aaa;padding:10px 0}.kx-sidebar-content-region.notifications .kx-ribbon-region .kx-notifications-settings-container .kx-notifications-settings-item-btn{width:100%;color:#888;background-color:#2d2d2d;border:1px solid #888;-webkit-border-radius:5px;-moz-border-radius:5px;-ms-border-radius:5px;-o-border-radius:5px;border-radius:5px;font-size:14px;line-height:18px;height:30px;padding:6px}.kx-sidebar-content-region.notifications .kx-ribbon-region .kx-notifications-settings-container .kx-notifications-settings-item-btn:hover{background-color:#3a3a3a}.kx-sidebar-content-region.notifications .kx-ribbon-region .kx-notifications-settings-container .kx-notifications-settings-item-checkbox{background-repeat:no-repeat;color:#636363;font-size:11px;line-height:initial;display:block;height:19px;margin-bottom:10px}.kx-sidebar-content-region.notifications .kx-ribbon-region .kx-notifications-settings-container .kx-notifications-settings-item-checkbox input[type=checkbox]{display:none}.kx-sidebar-content-region.notifications .kx-ribbon-region .kx-notifications-settings-container .kx-notifications-settings-item-checkbox label{display:block;font-size:11px;color:#bebebe;cursor:pointer;position:relative;padding-left:25px;padding-top:3px;padding-bottom:3px}.kx-sidebar-content-region.notifications .kx-ribbon-region .kx-notifications-settings-container .kx-notifications-settings-item-checkbox label:before{content:'';background-image:url(/modules/notifications/images/notifications/checkboxes.png?1463612477);background-position:0 -20px;background-repeat:no-repeat;width:20px;height:20px;position:absolute;left:0;top:0}.kx-sidebar-content-region.notifications .kx-ribbon-region .kx-notifications-settings-container .kx-notifications-settings-item-checkbox input[type=checkbox]:checked+label:before{background-image:url(/modules/notifications/images/notifications/checkboxesalt2.png?1463612477);background-position:0 0;background-repeat:no-repeat}.kx-sidebar-content-region.notifications .kx-ribbon-region .kx-notifications-settings-container .kx-notifications-settings-item-checkbox input[type=checkbox]:not(:checked)+label:hover::before{background-image:url(/modules/notifications/images/notifications/checkboxes.png?1463612477);background-position:0 -20px;background-repeat:no-repeat;filter:alpha(opacity=30);opacity:1}.kx-sidebar-content-region.notifications .kx-ribbon-region .kx-notifications-settings-container .kx-notifications-settings-item-child{padding-left:24px}.kx-notifications-panel{padding:0}.kx-notifications-panel .kx-heading{height:32px;background-color:transparent;background-image:url(/modules/notifications/images/../../chat/images/chat-header.png?1463612477);background-repeat:no-repeat;background-size:100% 100%;background-position:center bottom;border-bottom:1px solid #202020}.kx-notifications-panel .kx-heading .kx-heading-title{display:inline-block;line-height:32px;vertical-align:middle}.kx-notifications-panel .kx-heading .kx-heading-title span{line-height:100%;padding-left:7px;vertical-align:middle;font-size:13px;font-weight:700;color:#6b6b6b;font-family:proxima-nova,'helvetica neue',helvetica,arial,sans-serif;text-transform:uppercase;background:-webkit-linear-gradient(#ddd,#333);-webkit-background-clip:text;-webkit-text-fill-color:transparent}.kx-notifications-panel .kx-heading .kx-clear-button{position:absolute;right:37px;top:8px;height:19px}.kx-notifications-panel .kx-heading .kx-settings-button{position:absolute;right:8px;top:8px;width:20px;height:19px;background-image:url(/modules/notifications/images/../../common/images/settings-cog.png?1463612477);background-position:center top;cursor:pointer}.kx-notifications-panel .kx-heading .kx-settings-button:hover{background-position:center bottom}.kx-notifications-panel .kx-notifications-item-list .kx-notifications-empty-indicator .kx-notifications-empty-indicator-icon{background-image:url(/modules/notifications/images/notifications/empty-notifications.png?1463612477);background-position:center;background-repeat:no-repeat;width:100%;height:45px;margin-top:15px;margin-bottom:5px}.kx-notifications-panel .kx-notifications-item-list .kx-notifications-empty-indicator .kx-notifications-empty-indicator-text{position:relative;top:0;text-align:center;text-transform:uppercase;font-size:12px;color:#a9a9a9}.kx-notifications-panel .kx-notifications-item-list .kx-notification-item{display:table;width:100%;height:50px;position:relative;margin-bottom:8px;background-color:#1b1b1b;padding:5px 0}.kx-notifications-panel .kx-notifications-item-list .kx-notification-item:hover{background-color:#2d2d2d}.kx-notifications-panel .kx-notifications-item-list .kx-notification-item .kx-notification-item-icon{display:table-cell;width:50px;text-align:center;vertical-align:middle}.kx-notifications-panel .kx-notifications-item-list .kx-notification-item .kx-notification-item-icon .kx-avatar{display:inline-block}.kx-notifications-panel .kx-notifications-item-list .kx-notification-item .kx-notification-item-icon .kx-avatar .kx-system-notification-image{display:inline-block;width:27px;height:27px;background-size:cover;background-position:center center}.kx-notifications-panel .kx-notifications-item-list .kx-notification-item.kx-game-update .kx-notification-item-icon div{border:1px solid #000;display:inline-block;vertical-align:middle;text-align:center;height:29px;width:29px}.kx-notifications-panel .kx-notifications-item-list .kx-notification-item.kx-game-update .kx-notification-item-icon div img{width:27px;height:27px}.kx-notifications-panel .kx-notifications-item-list .kx-notification-item .kx-notification-item-content{display:table-cell;overflow:hidden;word-break:normal;word-wrap:break-word;line-height:12px;vertical-align:middle}.kx-notifications-panel .kx-notifications-item-list .kx-notification-item .kx-notification-item-content .kx-notification-item-content-sub-row{width:100%;padding-bottom:14px}.kx-notifications-panel .kx-notifications-item-list .kx-notification-item .kx-notification-item-content .kx-notification-item-content-title{color:#e9e9e9;font-family:myriad-pro,verdana,helvetica,sans-serif;font-size:12px;float:left;max-width:170px;font-weight:400}.kx-notifications-panel .kx-notifications-item-list .kx-notification-item .kx-notification-item-content .kx-notification-item-content-title+br{display:none}.kx-notifications-panel .kx-notifications-item-list .kx-notification-item .kx-notification-item-content strong{display:inline;width:100%;color:#e9e9e9;font-family:myriad-pro,verdana,helvetica,sans-serif;font-size:12px;font-weight:700}.kx-notifications-panel .kx-notifications-item-list .kx-notification-item .kx-notification-item-content strong+br{display:none}.kx-notifications-panel .kx-notifications-item-list .kx-notification-item .kx-notification-item-content .kx-notification-item-content-title:after,.kx-notifications-panel .kx-notifications-item-list .kx-notification-item .kx-notification-item-content strong:after{content:' ';display:inline-block;width:8px}.kx-notifications-panel .kx-notifications-item-list .kx-notification-item .kx-notification-item-content .kx-notification-item-content-title:empty,.kx-notifications-panel .kx-notifications-item-list .kx-notification-item .kx-notification-item-content .kx-notification-item-content-title:empty:after,.kx-notifications-panel .kx-notifications-item-list .kx-notification-item .kx-notification-item-content strong:empty,.kx-notifications-panel .kx-notifications-item-list .kx-notification-item .kx-notification-item-content strong:empty:after{display:none}.kx-notifications-panel .kx-notifications-item-list .kx-notification-item .kx-notification-item-content .kx-notification-item-content-msg{max-height:36px;max-width:275px;font-size:12px;color:#a9a9a9;line-height:12px}.kx-notifications-panel .kx-notifications-item-list .kx-notification-item .kx-notification-item-content .kx-notification-item-content-ctas{width:100%;max-height:36px;font-size:12px;color:#a9a9a9;line-height:12px;font-weight:700;display:none}.kx-notifications-panel .kx-notifications-item-list .kx-notification-item .kx-notification-item-content .kx-notification-item-content-ctas .kx-notification-item-content-cta{text-decoration:underline;cursor:pointer;float:left}.kx-notifications-panel .kx-notifications-item-list .kx-notification-item .kx-notification-item-content .kx-notification-item-content-ctas .kx-notification-item-content-cta-divider{float:left;padding:0 5px}.kx-notifications-panel .kx-notifications-item-list .kx-notification-item .kx-notification-item-content .kx-notification-item-content-color-red{color:#b00000}.kx-notifications-panel .kx-notifications-item-list .kx-notification-item .kx-notification-item-content .kx-notification-item-content-color-green{color:#0F0}.kx-notifications-panel .kx-notifications-item-list .kx-notification-item .kx-notification-item-content .kx-notification-item-created-at{font-family:myriad-pro,verdana,helvetica,sans-serif;font-size:11px;color:#888;float:right;padding:0 10px 0 5px}.kx-notifications-panel .kx-notifications-item-list .kx-notification-item .kx-notification-item-content .kx-notification-delete-btn{display:block;background-image:url(/modules/notifications/images/../../common/images/list-item-close-btn-sprite.png?1463612477);background-position:0 100%;background-repeat:no-repeat;float:right;height:14px;width:14px;margin-right:4px;cursor:pointer}.kx-notifications-panel .kx-notifications-item-list .kx-notification-item .kx-notification-item-content .kx-notification-delete-btn:hover{background-position:0 0}.kx-notifications-panel .kx-notifications-item-list .kx-notification-item .kx-short{width:140px}.kx-notifications-panel .kx-notifications-item-list .kx-notification-item.kx-notification-item-group-invite .kx-notification-item-content{width:142px}.kx-notifications-panel .kx-notifications-item-list .kx-notification-item.kx-clickable{cursor:pointer}.kx-notifications-panel .count{border:1px solid #000;border-radius:2px;cursor:pointer;font-size:10px;height:12px;line-height:12px;text-align:center;vertical-align:middle;width:16px;position:absolute;top:2px;visibility:visible;right:-10px}.kx-notifications-panel .red{color:#FFF;background-color:#b00000}";head.appendChild(style);}());

(function () {this.Templates=this.Templates||{},this.Templates["notifications/notification-settings-item-view"]=Handlebars.template(function(t,i,a,e,n){function s(){return' checked="checked"'}this.compilerInfo=[4,">= 1.0.0"],a=this.merge(a,t.helpers),n=n||{};var l,o,c="",h="function",d=this.escapeExpression,r=this;return c+='<input type="checkbox" id="',(o=a.id)?l=o.call(i,{hash:{},data:n}):(o=i&&i.id,l=typeof o===h?o.call(i,{hash:{},data:n}):o),c+=d(l)+'" class="notification-settings-item"',l=a["if"].call(i,i&&i.isChecked,{hash:{},inverse:r.noop,fn:r.program(1,s,n),data:n}),(l||0===l)&&(c+=l),c+='/>\n<label class="kx-ellipsis" title="',(o=a.text)?l=o.call(i,{hash:{},data:n}):(o=i&&i.text,l=typeof o===h?o.call(i,{hash:{},data:n}):o),c+=d(l)+'" for="',(o=a.id)?l=o.call(i,{hash:{},data:n}):(o=i&&i.id,l=typeof o===h?o.call(i,{hash:{},data:n}):o),c+=d(l)+'">',(o=a.text)?l=o.call(i,{hash:{},data:n}):(o=i&&i.text,l=typeof o===h?o.call(i,{hash:{},data:n}):o),c+=d(l)+"</label>\n"}),this.Templates["notifications/notification-settings-items-composite-view"]=Handlebars.template(function(t,i,a,e,n){return this.compilerInfo=[4,">= 1.0.0"],a=this.merge(a,t.helpers),n=n||{},'<ul class="kx-notifications-settings-container"></ul>\n'}),this.Templates["notifications/notifications-content-layout"]=Handlebars.template(function(t,i,a,e,n){return this.compilerInfo=[4,">= 1.0.0"],a=this.merge(a,t.helpers),n=n||{},'<div class="kx-items-region"></div>\n<div class="kx-loading-region">\n<div class="kx-more-loading"></div>\n</div>\n'}),this.Templates["notifications/notifications-cta-layout"]=Handlebars.template(function(t,i,a,e,n){this.compilerInfo=[4,">= 1.0.0"],a=this.merge(a,t.helpers),n=n||{};var s,l,o="",c="function",h=this.escapeExpression;return o+='<div class="kx-heading-title">\n<span>',(l=a.headingText)?s=l.call(i,{hash:{},data:n}):(l=i&&i.headingText,s=typeof l===c?l.call(i,{hash:{},data:n}):l),o+=h(s)+'</span>\n</div>\n<div class="kx-settings-button"></div>\n'}),this.Templates["notifications/notifications-empty-layout"]=Handlebars.template(function(t,i,a,e,n){this.compilerInfo=[4,">= 1.0.0"],a=this.merge(a,t.helpers),n=n||{};var s,l,o="",c=a.helperMissing,h=this.escapeExpression;return o+='<div class="kx-notifications-empty-indicator">\n<div class="kx-notifications-empty-indicator-icon"></div>\n<div class="kx-notifications-empty-indicator-text">\n'+h((s=a.i18n||i&&i.i18n,l={hash:{},data:n},s?s.call(i,"notifications.empty",l):c.call(i,"i18n","notifications.empty",l)))+"\n</div>\n</div>\n"}),this.Templates["notifications/notifications-item-layout"]=Handlebars.template(function(t,i,a,e,n){function s(t,i){var e,n,s="";return s+='\n<div class="kx-notification-item-content-ctas">\n',(n=a.cta)?e=n.call(t,{hash:{},data:i}):(n=t&&t.cta,e=typeof n===h?n.call(t,{hash:{},data:i}):n),(e||0===e)&&(s+=e),s+="\n</div>\n"}this.compilerInfo=[4,">= 1.0.0"],a=this.merge(a,t.helpers),n=n||{};var l,o,c="",h="function",d=this.escapeExpression,r=this;return c+='<div class="kx-notification-item-icon kx-clickable"></div>\n<div class="kx-notification-item-content">\n<div class="kx-notification-item-content-sub-row">\n<div class="kx-notification-item-content-title kx-ellipsis">',(o=a.title)?l=o.call(i,{hash:{},data:n}):(o=i&&i.title,l=typeof o===h?o.call(i,{hash:{},data:n}):o),c+=d(l)+'</div>\n<div class="kx-notification-item-created-at">',(o=a.dateCreated)?l=o.call(i,{hash:{},data:n}):(o=i&&i.dateCreated,l=typeof o===h?o.call(i,{hash:{},data:n}):o),(l||0===l)&&(c+=l),c+='</div>\n<div class="kx-notification-delete-btn kx-clickable" style="display:none"></div>\n</div>\n<div class="kx-notification-item-content-msg ',(o=a.msgColor)?l=o.call(i,{hash:{},data:n}):(o=i&&i.msgColor,l=typeof o===h?o.call(i,{hash:{},data:n}):o),c+=d(l)+'">',(o=a.message)?l=o.call(i,{hash:{},data:n}):(o=i&&i.message,l=typeof o===h?o.call(i,{hash:{},data:n}):o),c+=d(l)+"</div>\n\n",l=a["if"].call(i,i&&i.cta,{hash:{},inverse:r.noop,fn:r.program(1,s,n),data:n}),(l||0===l)&&(c+=l),c+="\n\n</div>\n"}),this.Templates["notifications/system-notification-image-item-view"]=Handlebars.template(function(t,i,a,e,n){this.compilerInfo=[4,">= 1.0.0"],a=this.merge(a,t.helpers),n=n||{};var s,l,o="",c="function",h=this.escapeExpression;return o+='<div class="kx-avatar-wrapper">\n<div class="kx-system-notification-image" style="background-image: url(\'',(l=a.url)?s=l.call(i,{hash:{},data:n}):(l=i&&i.url,s=typeof l===c?l.call(i,{hash:{},data:n}):l),o+=h(s)+"');\"></div>\n</div>\n"});}());

/* kxl-deployment-tools 2016-05-18 */

KXL.module("NotificationsApp",function(a,b){var c={getNotifications:function(){return new a.Notifications.Controller.getNotificationsView}};b.addInitializer(function(){b.reqres.setHandlers({"notifications:get":function(){return c.getNotifications()}})})}),KXL.module("NotificationsApp.Notifications",function(a,b,c,d,e,f){a.Controller={getNotificationsView:function(){return n()},getSystemNotifications:function(){if(!a.feedView)return[];var b=a.feedView.collection.filter(function(a){return"system"===a.attributes.type});return b}},a.sidebarViews={topBarView:null,contentView:null,headerCTAView:null};var g=new c.Wreqr.EventAggregator,h=function(a,c,d){var e=b.request("current:user:settings:entity");e.set(c,d),e.save().then(function(){m()})},i=function(a,c,d){var e=a.get("id"),f=b.currentUserGroups.get(e),g=f&&f.get("group"),h=g&&g.get("members"),i=h&&h.get(b.currentUser.id);if(i){var j=i.get("settings")||{};j[c]=d,i.set("settings",j),i.save({settings:j},{patch:!0}).then(function(){m()})}},j=function(a,b){var c=!0;a.each(function(a){a.has("parent")&&a.get("parent")===b&&a.get("isChecked")&&(c=!1)});var d=a.findWhere({id:b});d.set("isChecked",!c)},k=function(){var a=b.request("current:user:settings:entity"),d=new c.Collection([{text:b.i18n.t("notifications.clear"),type:"button",trigger:"clear:clicked"},{text:"General Notifications",type:"label"},{id:"showWallPosts",isChecked:a.get("showWallPosts"),text:b.i18n.t("notifications.settings.showWallPosts"),type:"checkbox",group:"general"},{id:"showAttackNotifications",isChecked:a.get("showAttackNotifications"),text:b.i18n.t("notifications.settings.showAttackNotifications"),type:"checkbox",group:"general"},{id:"showGiftNotifications",isChecked:a.get("showGiftNotifications"),text:b.i18n.t("notifications.settings.showGiftNotifications"),type:"checkbox",group:"general"},{id:"showGameInviteNotifications",isChecked:a.get("showGameInviteNotifications"),text:b.i18n.t("notifications.settings.showGameInviteNotifications"),type:"checkbox",group:"general"},{id:"showGameUpdateNotifications",isChecked:a.get("showGameUpdateNotifications"),text:b.i18n.t("notifications.settings.showGameUpdateNotifications"),type:"checkbox",group:"general"},{text:"Forum Notifications",type:"label"},{id:"showForumUpdatesToBookmarkedThread",isChecked:a.get("showForumUpdatesToBookmarkedThread"),text:b.i18n.t("notifications.settings.showForumUpdatesToBookmarkedThread"),type:"checkbox",group:"forum"},{id:"showForumUpdatesToCreatedThread",isChecked:a.get("showForumUpdatesToCreatedThread"),text:b.i18n.t("notifications.settings.showForumUpdatesToCreatedThread"),type:"checkbox",group:"forum"},{id:"showForumUpdatesToRepliedThread",isChecked:a.get("showForumUpdatesToRepliedThread"),text:b.i18n.t("notifications.settings.showForumUpdatesToRepliedThread"),type:"checkbox",group:"forum"},{id:"showForumUpdatesToQuotedThread",isChecked:a.get("showForumUpdatesToQuotedThread"),text:b.i18n.t("notifications.settings.showForumUpdatesToQuotedThread"),type:"checkbox",group:"forum"},{id:"showForumUpdatesToVotedThread",isChecked:a.get("showForumUpdatesToVotedThread"),text:b.i18n.t("notifications.settings.showForumUpdatesToVotedThread"),type:"checkbox",group:"forum"},{text:"Group Notifications",type:"label"},{id:"showGroupInviteNotifications",isChecked:a.get("showGroupInviteNotifications"),text:"Invites",type:"checkbox",group:"group"},{id:"showGroupAcceptedApplicationNotifications",isChecked:a.get("showGroupAcceptedApplicationNotifications"),text:"Accepted Applications",type:"checkbox",group:"group"},{id:"showGroupPromotionDemotionNotifications",isChecked:a.get("showGroupPromotionDemotionNotifications"),text:"Promotions & Demotions",type:"checkbox",group:"group"},{id:"showAllGroupPostNotifications",isChecked:!1,text:"Post likes, comments & shares",type:"checkbox",group:"group"}]),e=new c.FilteredCollection(null,{collection:b.currentUserGroups});e.setFilter(function(a){var c=a&&a.get("group"),d=c&&c.get("members");return!(!d||!d.get(b.currentUser.id))});var f=d.findWhere({id:"showAllGroupPostNotifications"});return e.each(function(b){var c;c=b.get("settings")&&b.get("settings").has("showPostNotifications")?b.get("settings").get("showPostNotifications"):a.has("showGroupNotifications")&&a.get("showGroupNotifications")===!1?!1:!0,d.add({id:b.get("group").get("id"),isChecked:c,text:b.get("group").get("title"),group:"group",type:"checkbox",parent:"showAllGroupPostNotifications"}),c&&f.set("isChecked",!0)}),d},l=k(),m=function(){var c=b.request("get:userNotifications",{data:{limit:10}});c.done(function(c){c.on("total:changed",function(){b.vent.trigger("user:userNotifications:count:changed",this.totalAvailable)}),b.vent.on("reset:available:notifications",function(){if(c.totalAvailable>0){var a=b.request("current:user:settings:entity");a.set("notificationPanelLastViewed",Date.now()),a.save(),c.totalAvailable=0,b.vent.trigger("user:userNotifications:count:changed",c.totalAvailable)}});var d=b.module("Websocket");d.on("notification",function(a){var d=b.request("current:user:settings:entity"),e=!1;if(f.each(b.config.notificationSettings,function(b){f.each(b.filteredNotificationTypes,function(c){c===a.type&&(d.get(b.settingId)||"showAllGroupPostNotifications"===b.settingId?a.group&&l.each(function(c){c.get("id")!==a.group.id||c.get("isChecked")||b.settingId!==c.get("parent")||(e=!0)}):e=!0)})}),!e){var g;if(a.id&&(g=c.get(a.id)),g){var h=new b.Entities.NotificationItem(a);c.add(h,{merge:!0})}else c.unshift(a),c.totalAvailable++,b.vent.trigger("user:userNotifications:count:changed",c.totalAvailable)}}),a.feedView=new a.CollectionView({collection:c,vent:g}),a.feedView.on("cta:clicked",function(){a.sidebarViews.contentView.trigger("cta:clicked")}),a.sidebarViews.contentView.feed.show(a.feedView),a.sidebarViews.contentView.isLoading=!1,b.vent.trigger("user:userNotifications:count:changed",c.totalAvailable)}).fail(function(a){console.error("Failed to load notifications!",a)})},n=function(){return a.sidebarViews.contentView=new a.mainLayout({vent:g}),a.sidebarViews.topBarView=new a.SettingsView({vent:g,collection:l}),a.sidebarViews.topBarView.on("clear:clicked",function(){b.request("delete:userNotifications"),a.feedView&&a.feedView.collection&&a.feedView.collection.reset(),b.vent.trigger("reset:available:notifications")}),a.sidebarViews.topBarView.on("setting:item:save:setting",function(a,b,c){h(a.model,b,c)}),a.sidebarViews.topBarView.on("setting:item:save:group:setting",function(a,b,c){i(a.model,b,c),a.model.has("parent")&&j(this.collection,a.model.get("parent"))}),a.sidebarViews.topBarView.on("setting:item:check:child:notification:settings",function(a,b,c,d){this.collection.each(function(a){a.has("parent")&&a.get("parent")===b&&a.get("isChecked")!==d&&(a.set("isChecked",d),i(a,c,d))})}),a.sidebarViews.headerCTAView=a.ctaLayout,a.sidebarViews.contentView.on("show",function(){m()}),a.sidebarViews}}),KXL.module("NotificationsApp.Notifications",function(a,b,c,d,e,f){a.View=b.Components.Layout.extend({template:Templates["notifications/notifications-layout"],className:"kx-notifications"}),a.EmptyView=d.Layout.extend({template:Templates["notifications/notifications-empty-layout"]}),a.NotificationItemView=d.Layout.extend({template:Templates["notifications/notifications-item-layout"],tagName:"div",className:"kx-notification-item",snippetLength:70,titleLength:35,regions:{avatar:".kx-notification-item-icon"},ui:{icon:".kx-notification-item-icon",content:".kx-notification-item-content",title:".kx-notification-item-content-title",dateCreated:".kx-notification-item-created-at",msg:".kx-notification-item-content-msg",cta:".kx-notification-item-content-cta",ctas:".kx-notification-item-content-ctas",deleteBtn:".kx-notification-delete-btn"},events:{"click .kx-notification-item-content-cta-default":"onCTAClickedWrapper","click @ui.deleteBtn":"onDeleteClicked",mouseover:"onMouseOver",mouseout:"onMouseOut",mousedown:"onMouseDown","mouseover .kx-clickable":"onClickableOver","mouseout .kx-clickable":"onClickableOut"},modelEvents:{change:"render"},templateHelpers:function(){var a,c,d=this,e=this.model.toJSON(),g=e.content;switch(e.type){case"notif-wall":c="wall",a=!0;break;case"notif-thread":case"notif-thread-replied":case"notif-thread-replied-bookmarked":case"notif-thread-replied-created":case"notif-thread-replied-replied":case"notif-thread-quoted":case"notif-thread-voted":c="forums",a=!0;break;case"game-update":c="game",a=!0;break;default:c=null}return{title:function(){var a=null;return a="function"==typeof d.title?d.title():d.title,a&&(a=b.Common.Utils.StringUtils.truncateEllipsis(a,d.titleLength)),a||""},cta:function(){if("function"==typeof d.cta){var a=d.cta();if(f.isArray(a)){var b="";return f.each(a,function(c,d){b+='<div class="kx-notification-item-content-cta kx-clickable '+c.className+'">'+c.text+"</div>",d!==a.length-1&&(b+='<div class="kx-notification-item-content-cta-divider"> | </div>')}),b}return'<div class="kx-notification-item-content-cta kx-notification-item-content-cta-default kx-clickable">'+d.cta()+"</div>"}},message:function(){return"function"==typeof d.message?d.message():b.Common.Utils.StringUtils.truncateEllipsis(g,d.snippetLength)},msgColor:function(){if(d.msgColor){if("red"===d.msgColor)return"kx-notification-item-content-color-red";if("green"===d.msgColor)return"kx-notification-item-content-color-green"}},dateCreated:function(){return b.Common.Utils.DateUtils.fuzzytime2(e.createdAt)},hasValidType:a,notiType:c}},getAvatar:function(){var a=this;if(this.model.get("fromId")){var c=b.request("new:avatar:view",this.model.get("fromId"),{avatarMenu:b.Components.Avatar.avatarMenu.ON,size:"small",color:"black"});return this.listenTo(c,["clicked","ignore:clicked","friend-request:clicked","friend-remove:clicked","friend-chat:clicked"].join(" "),function(){a.trigger("cta:clicked")}),c}},hasCTA:function(){return"function"==typeof this.cta?!0:!1},onRender:function(){this.avatar.show(this.getAvatar()),this.hasCTA()&&!f.isArray(this.cta())&&(this.wholeNotieIsClickable=!0,this.$el.addClass("kx-clickable"))},onMouseOver:function(){this.hasCTA()&&(this.ui.msg.hide(),this.ui.ctas.show()),this.ui.dateCreated.hide(),this.ui.deleteBtn.show(),b.vent.trigger("reset:available:notifications")},onMouseOut:function(){this.hasCTA()&&(this.ui.ctas.hide(),this.ui.msg.show()),this.ui.dateCreated.show(),this.ui.deleteBtn.hide()},onMouseDown:function(){this.hasCTA()&&!f.isArray(this.cta())&&this.wholeNotieIsClickable&&this.onCTAClickedWrapper()},onClickableOver:function(){this.wholeNotieIsClickable=!1},onClickableOut:function(){this.wholeNotieIsClickable=!0},onCTAClickedWrapper:function(){this.onCTAClicked()},onCTAClicked:function(){b.execute("profile:show",this.model.get("fromId")),this.trigger("cta:clicked")},onDeleteClicked:function(a){a.stopPropagation(),this.deleteNotification()},deleteNotification:function(){this.model.collection&&this.model.destroy()}}),a.HiddenView=a.NotificationItemView.extend({}),a.ThreadUpdatedView=a.NotificationItemView.extend({title:function(){return this.model.get("forumDiscussion").subject||""},cta:function(){return b.i18n.t("notifications.cta.joinConversation")},onCTAClicked:function(){var a=this.model.get("forumDiscussion").path;0===a.indexOf("/forum/")&&(a=a.slice(7)),b.execute("forum:show",a)}}),a.WallPostView=a.NotificationItemView.extend({title:function(){return this.model.get("from").username},cta:function(){return b.i18n.t("notifications.cta.joinConversation")},onCTAClicked:function(){b.execute("profile:show",b.currentUser.id)},message:function(){return b.i18n.t("notifications.msg.postedOnWall")+'  "'+b.Common.Utils.StringUtils.truncateEllipsis(this.model.get("content"),this.snippetLength)+'"'}}),a.GameUpdateView=a.NotificationItemView.extend({className:"kx-notification-item kx-game-update",title:function(){var a=b.games.get(this.model.get("gameId"));return a?a.get("name"):""},getAvatar:function(){return this.model.get("gameId")?b.request("new:game:logo:view",this.model.get("gameId")):void 0},cta:function(){return b.i18n.t("notifications.cta.play")},onCTAClicked:function(){b.execute("game:show",b.games.get(this.model.get("gameId")).get("urlName"))}}),a.GameInviteView=a.NotificationItemView.extend({title:function(){var a=b.games.get(this.model.get("gameId"));return a?a.get("name"):""},cta:function(){return b.i18n.t("notifications.cta.play")},onCTAClicked:function(){b.execute("game:show",b.games.get(this.model.get("gameId")).get("urlName"))}}),a.UrgentView=a.NotificationItemView.extend({title:function(){return b.i18n.t("notifications.title.urgent")},cta:function(){return b.i18n.t("notifications.cta.getRevenge")},onCTAClicked:function(){b.execute("game:show",b.games.get(this.model.get("gameId")).get("urlName"))},msgColor:"red"}),a.GiftSentView=a.NotificationItemView.extend({title:function(){return b.i18n.t("notifications.title.gift-sent")},onCTAClicked:function(){b.execute("game:show",b.games.get(this.model.get("gameId")).get("urlName"))},msgColor:"green",cta:function(){return b.i18n.t("notifications.gift.claimGift")}}),a.GroupNotificationBaseItemView=a.NotificationItemView.extend({onCTAClicked:function(){var a=this;b.asyncRequest("async:load:module","group").then(function(){b.execute("group:show",a.model.get("group").id)})},cta:function(){return b.i18n.t("notifications.group.discovery.viewGroup")}}),a.MemberPromotedView=a.GroupNotificationBaseItemView.extend({title:function(){return this.model.get("from").username},message:function(){return b.i18n.t("notifications.group.member.promoted.msg",{rank:this.model.get("group").rankTitle,group:this.model.get("group").title})}}),a.MemberDemotedView=a.GroupNotificationBaseItemView.extend({title:function(){return this.model.get("from").username},message:function(){return b.i18n.t("notifications.group.member.demoted.msg",{rank:this.model.get("group").rankTitle,group:this.model.get("group").title})}}),a.GroupDiscussionCommentView=a.GroupNotificationBaseItemView.extend({title:function(){return this.model.get("from").username},message:function(){return b.i18n.t("notifications.group.comment.added.msg",{group:this.model.get("group").title})},cta:function(){return b.i18n.t("notifications.cta.joinConversation")}}),a.GroupDiscussionLikeView=a.GroupNotificationBaseItemView.extend({title:function(){return this.model.get("from").username},message:function(){return b.i18n.t("notifications.group.post.liked.msg",{group:this.model.get("group").title})}}),a.MemberInvitedView=a.NotificationItemView.extend({title:function(){return this.model.get("from").username},initialize:function(){var a=this;b.asyncRequest("async:load:module","group").then(function(){b.currentUserGroups&&(b.currentUserGroups.get(a.model.get("group").id)?a.deleteNotification():a.listenTo(b.currentUserGroups,"add",function(b){b.get("group").id===a.model.get("group").id&&a.deleteNotification()}))})},message:function(){return b.i18n.t("notifications.group.invite.msg",{group:this.model.get("group").title})},events:f.extend({"click .kx-accept-invite":"acceptInvite","click .kx-reject-invite":"rejectInvite"},a.NotificationItemView.prototype.events),cta:function(){return[{text:b.i18n.t("group.member.invite.notification.reject"),className:"kx-reject-invite"},{text:b.i18n.t("group.member.invite.notification.accept"),className:"kx-accept-invite"}]},acceptInvite:function(){var a=this;b.asyncRequest("async:load:module","group").then(function(){return b.currentUserGroups&&b.currentUserGroups.get(a.model.get("group").id)?(a.deleteNotification(),b.execute("group:show",a.model.get("group").id)):void b.asyncRequest("group:member:add",b.currentUser.id,a.model.get("group").id).then(function(){b.asyncRequest("group:get:user:group",b.currentUser.id,a.model.get("group").id).then(function(c){b.currentUserGroups.add(c,{parse:!0,merge:!0}),b.execute("group:show",a.model.get("group").id),a.deleteNotification()})}).fail(function(){var c=b.request("show:confirm:dialog",{title:b.i18n.t("header.notification.invite.invalid.title"),message:b.i18n.t("header.notification.invite.invalid.message"),confirmButtonOptions:{label:b.i18n.t("header.notification.invite.invalid.ok.btn")},showCancelButton:!1});c.on("confirm:clicked",function(){a.deleteNotification(),b.dialogRegion.close()})})})},rejectInvite:function(){var a=this;b.asyncRequest("async:load:module","group").then(function(){b.asyncRequest("group:invites:reject",b.currentUser.id,a.model.get("group").id),a.deleteNotification()})}}),a.NewApplicantView=a.GroupNotificationBaseItemView.extend({title:function(){return this.model.get("from").username},message:function(){return b.i18n.t("notifications.group.applicant.added.msg",{group:this.model.get("group").title})}}),a.NewMemberView=a.GroupNotificationBaseItemView.extend({title:function(){return this.model.get("from").username},message:function(){return b.i18n.t("notifications.group.member.added.msg",{group:this.model.get("group").title})}}),a.MemberBootedView=a.GroupNotificationBaseItemView.extend({title:function(){return this.model.get("from").username},message:function(){return b.i18n.t("notifications.group.member.removed.msg",{group:this.model.get("group").title})}}),a.MemberLeftView=a.GroupNotificationBaseItemView.extend({title:function(){return this.model.get("from").username},message:function(){return b.i18n.t("notifications.group.member.left.msg",{group:this.model.get("group").title})}}),a.GroupUpdatedView=a.GroupNotificationBaseItemView.extend({title:function(){return b.i18n.t("notifications.group.meta.changed.title")},message:function(){return b.i18n.t("notifications.group.meta.changed.msg",{meta:b.i18n.t("notifications.group.meta.changed.attribute.title"),group:this.model.get("group").title})}}),a.ApplicantAcceptedView=a.GroupNotificationBaseItemView.extend({title:function(){return b.i18n.t("notifications.group.applicant.accepted.title")},message:function(){return b.i18n.t("notifications.group.applicant.accepted.msg",{group:this.model.get("group").title})},getAvatar:function(){var a=this;if(this.model.get("userId")){var c=b.request("new:avatar:view",this.model.get("userId"),{avatarMenu:b.Components.Avatar.avatarMenu.ON,size:"small",color:"black"});return this.listenTo(c,["clicked","ignore:clicked","friend-request:clicked","friend-remove:clicked","friend-chat:clicked"].join(" "),function(){a.trigger("cta:clicked")}),c}}}),a.NewDiscussionView=a.GroupNotificationBaseItemView.extend({title:function(){return this.model.get("from").username},message:function(){return b.i18n.t("notifications.group.discussion.added.msg",{discussion:this.model.get("group").discussion.title,group:this.model.get("group").title})},cta:function(){return b.i18n.t("notifications.group.discussion.added.cta")}}),a.GroupDeleteView=a.NotificationItemView.extend({title:function(){return b.i18n.t("notifications.group.delete.title")},cta:function(){return b.i18n.t("group.browse.notification.cta")},message:function(){return b.i18n.t("notifications.group.delete.msg",{group:this.model.get("group").title})},onCTAClicked:function(){b.asyncRequest("async:load:module","group").then(function(){b.execute("group:show")})}}),a.FriendAcceptedView=a.NotificationItemView.extend({templateHelpers:function(){var a=this;return this.model.get("from").username?{title:this.model.get("from").username,message:b.i18n.t("notifications.msg.nowfriends"),dateCreated:function(){return b.Common.Utils.DateUtils.fuzzytime2(a.model.get("createdAt"))}}:{title:"You have a new friend",message:"",dateCreated:function(){return b.Common.Utils.DateUtils.fuzzytime2(a.model.get("createdAt"))}}}}),a.SystemView=a.NotificationItemView.extend({ImageView:d.ItemView.extend({template:Templates["notifications/system-notification-image-item-view"],className:"kx-avatar kx-border-none",templateHelpers:function(){var a=this;return{url:function(){if(a.options.url){var b=a.options.url;return b.match(/^\/\/kxl-site-content/)?b:"/modules/header".concat(b)}return"/modules/header/images/notifications/kixeye.png"}}}}),getAvatar:function(){return new this.ImageView({url:this.model.get("imageUrl")})},onCTAClicked:function(){var a=this.model.get("url");a&&(0===a.indexOf("/forum/")&&(a=a.slice(7),b.execute("forum:show",a)),0===a.indexOf("/game/")&&(a=a.slice(6),b.execute("game:show",a)))}}),a.CollectionView=d.CompositeView.extend({className:"kx-notifications-item-list",tagName:"div",template:function(){return""},itemView:a.NotificationItemView,emptyView:a.EmptyView,itemViewEventPrefix:"notification:item",initialize:function(){this.totalNotificationsDisplayed=0},appendHtml:function(a,c,d){var e=a.getItemViewContainer(a);0===d?(e.prepend(c.$el),b.config.animationCapabilities&&!this.isBuffering&&TweenLite.fromTo(c.$el,.5,{opacity:0,ease:"Power2.easeInOut"},{opacity:1,ease:"Power2.easeInOut"})):e.append(c.$el)},fetchMore:f.throttle(function(a){this.collection.fetch({remove:!1,data:{before:a,limit:10}})},500,{trailing:!1}),checkPaging:function(){var a=this.collection.paging&&this.collection.paging&&this.collection.paging.previous;a&&this.fetchMore(a)},buildItemView:function(b,c,d){if(this.collection&&this.collection.length){var e=f.extend({model:b},d);switch(e.model.get("type")){case"fa":case"friendadded":return new a.FriendAcceptedView(e);case"system":return new a.SystemView(e);case"game-update":return new a.GameUpdateView(e);case"urgent":case"notif-underattack":return new a.UrgentView(e);case"gift-sent":return new a.GiftSentView(e);case"invite":return new a.GameInviteView(e);case"notif-thread":case"notif-thread-replied":case"notif-thread-replied-bookmarked":case"notif-thread-replied-created":case"notif-thread-replied-replied":case"notif-thread-quoted":case"notif-thread-voted":return new a.ThreadUpdatedView(e);case"notif-wall":return new a.WallPostView(e);case"group-updated":return new a.GroupUpdatedView(e);case"group-applicant-added":return new a.NewApplicantView(e);case"group-applicant-accepted":return new a.ApplicantAcceptedView(e);case"group-new-member":return new a.NewMemberView(e);case"group-member-booted":return new a.MemberBootedView(e);case"group-member-promoted":return new a.MemberPromotedView(e);case"group-member-demoted":return new a.MemberDemotedView(e);case"group-member-left":return new a.MemberLeftView(e);case"group-new-discussion":return new a.NewDiscussionView(e);case"group-invite-added":return new a.MemberInvitedView(e);case"group-discussion-comment":return new a.GroupDiscussionCommentView(e);case"group-discussion-like":return new a.GroupDiscussionLikeView(e);case"group-deleted":return new a.GroupDeleteView(e);default:console.log("Got unknown notification type "+e.model.get("type"))}}return new a.EmptyView},onNotificationItemCtaClicked:function(){this.trigger("cta:clicked")},onAfterItemAdded:function(){var a=this;this.totalNotificationsDisplayed+=1,this.totalNotificationsDisplayed===this.collection.length&&f.delay(function(){a.options.vent&&a.options.vent.trigger("view:check:scrolling:at:bottom")},200)},onItemRemoved:function(){this.totalNotificationsDisplayed-=1,this.options.vent&&this.options.vent.trigger("view:check:scrolling:at:bottom")}}),a.SettingsLabelView=d.ItemView.extend({template:function(){return""},tagName:"li",className:"kx-notifications-settings-item-label",onRender:function(){this.$el.html(this.model.get("text"))}}),a.SettingsItemView=d.ItemView.extend({template:Templates["notifications/notification-settings-item-view"],tagName:"li",className:"kx-notifications-settings-item-checkbox",events:{"click input":"onSettingChanged"},modelEvents:{"change:isChecked":function(){this.$el.find("input").prop("checked",this.model.get("isChecked"))}},onSettingChanged:function(){var a=this.$el.find("input").is(":checked");this.model.set("isChecked",a),"showAllGroupPostNotifications"===this.model.get("id")?this.trigger("check:child:notification:settings","showAllGroupPostNotifications","showPostNotifications",a):this.model.has("parent")&&"showAllGroupPostNotifications"===this.model.get("parent")?this.trigger("save:group:setting","showPostNotifications",a):this.trigger("save:setting",this.model.get("id"),a)},onRender:function(){this.model.get("parent")&&this.$el.addClass("kx-notifications-settings-item-child")}}),a.SettingsView=d.CompositeView.extend({template:Templates["notifications/notification-settings-items-composite-view"],itemViewContainer:".kx-notifications-settings-container",itemViewEventPrefix:"setting:item",onRender:function(){var b=this;this.listenTo(a,"settings:clicked",function(){b.$el.parent().toggle(),b.options.vent&&(b.options.vent.trigger("content:size:adjust"),b.options.vent.trigger("content:isolate:scrolling",b.$el.parent()))})},onShow:function(){this.$el.parent().hide()},buildItemView:function(c){var d=f.extend({model:c},this.options),e=this;switch(c.get("type")){case"label":return new a.SettingsLabelView(d);case"button":var g=new b.Components.Button.View({label:c.get("text"),customClass:"kx-notifications-settings-item-btn"});return g.on("click",function(){e.trigger(c.get("trigger"))}),g;default:return new a.SettingsItemView(d)}}}),a.ctaLayout=d.Layout.extend({template:Templates["notifications/notifications-cta-layout"],className:"kx-notification-cta-template",events:{"click .kx-settings-button":function(){a.trigger("settings:clicked")}},templateHelpers:function(){var a={};return this.options.title&&(a.headingText=this.options.title),a}}),a.mainLayout=d.Layout.extend({isLoading:!0,allItemsLoaded:!1,template:Templates["notifications/notifications-content-layout"],className:"kx-notifications-panel",regions:{settings:".kx-settings-region",feed:".kx-items-region"},onRender:function(){var a=this;this.on("sidebar:content:at:bottom:scroll",function(){a.feed.currentView&&a.feed.currentView.checkPaging()}),this.feed.on("show",function(){a.sizeAdjust()})},sizeAdjust:function(){this.feed.currentView&&this.options.vent.trigger("content:isolate:scrolling",this.$el.parent())}})});
//# sourceMappingURL=notifications.min.js.map