(function () {if (KXL && KXL.i18n && KXL.i18n.addLocales) {KXL.i18n.addLocales({"special_offer.levelup.congratulations":"Welcome back, Commander!","special_offer.levelup.celebrate":"Your distinguished service has earned you a reward:","special_offer.levelup.get_gold":"GET GOLD","special_offer.levelup.gold_for":"GOLD for","special_offer.levelup.only":"only","special_offer.levelup.limited_time_offer":"LIMITED TIME OFFER!"});}}());

(function () {var head = document.getElementsByTagName("head")[0];var style = document.createElement("style");style.type = "text/css";style.innerHTML = ".kx-special-offer-bar{background-color:#242424;font-family:proxima-nova,'helvetica neue',helvetica,arial,sans-serif;font-weight:600;font-size:20px;text-shadow:0 1px 1px rgba(0,0,0,.75);width:100%;height:234px;margin:0 auto;color:#929292;text-align:center;overflow:hidden}.kx-special-offer-bar .kx-special-offer-bar-content{width:500px;height:192px;display:inline-block;position:relative;top:-20px}.kx-special-offer-bar .kx-special-offer-bar-bold{font-size:24px;font-weight:500;margin:5px 0 10px;color:#fefefe}.kx-special-offer-bar .kx-special-offer-bar-left-bg{width:443px;height:192px;background-image:url(/modules/special_offer/images/gold_left.png);display:inline-block;position:relative}.kx-special-offer-bar .kx-special-offer-bar-right-bg{width:476px;height:192px;background-image:url(/modules/special_offer/images/gold_right.png);display:inline-block;position:relative}.kx-special-offer-bar .kx-special-offer-old-amount{display:inline-block;position:relative}.kx-special-offer-bar .kx-special-offer-new-amount{color:#b00000;font-size:28px;font-weight:500}.kx-special-offer-bar .kx-special-offer-bar-left-text{text-align:center;position:absolute;width:73px;top:57px;left:332px;font-size:20px;color:#fefefe;transform:rotate(10deg);-webkit-transform:rotate(10deg);-ms-transform:rotate(10deg)}.kx-special-offer-bar .kx-special-offer-cross-out{display:inline-block;position:absolute;top:-3px;left:5px;background-image:url(/modules/special_offer/images/crossout.png);height:32px;width:26px}.kx-special-offer-bar .kx-close-ribbon{height:9px;width:9px;position:absolute;top:6px;right:6px;background-image:url(/modules/special_offer/images/close-ribbon.jpg);background-position:center center;background-repeat:no-repeat;cursor:pointer}.kx-special-offer-bar .kx-special-offer-bar-cta-button{margin:20px}";head.appendChild(style);}());

(function () {this.Templates=this.Templates||{},this.Templates["special_offer/kx-special-offer-bar"]=Handlebars.template(function(a,l,e,i,s){this.compilerInfo=[4,">= 1.0.0"],e=this.merge(e,a.helpers),s=s||{};var c,n,o,f="",t=e.helperMissing,r=this.escapeExpression,p="function";return f+='<div class="kx-special-offer-bar-inner row">\n<div class="kx-close-btn-region"></div>\n<div class="kx-special-offer-bar-left-bg"><div class="kx-special-offer-bar-left-text">'+r((n=e.i18n||l&&l.i18n,o={hash:{},data:s},n?n.call(l,"special_offer.levelup.limited_time_offer",o):t.call(l,"i18n","special_offer.levelup.limited_time_offer",o)))+'</div></div>\n<div class="kx-special-offer-bar-content">\n<div class="kx-special-offer-bar-bold">'+r((n=e.i18n||l&&l.i18n,o={hash:{},data:s},n?n.call(l,"special_offer.levelup.congratulations",o):t.call(l,"i18n","special_offer.levelup.congratulations",o)))+"</div>\n<div>"+r((n=e.i18n||l&&l.i18n,o={hash:{},data:s},n?n.call(l,"special_offer.levelup.celebrate",o):t.call(l,"i18n","special_offer.levelup.celebrate",o)))+'</div>\n<div class="kx-special-offer-bar-bold">',(n=e.quantity)?c=n.call(l,{hash:{},data:s}):(n=l&&l.quantity,c=typeof n===p?n.call(l,{hash:{},data:s}):n),f+=r(c)+" "+r((n=e.i18n||l&&l.i18n,o={hash:{},data:s},n?n.call(l,"special_offer.levelup.gold_for",o):t.call(l,"i18n","special_offer.levelup.gold_for",o)))+' <div class="kx-special-offer-old-amount">',(n=e.oldAmount)?c=n.call(l,{hash:{},data:s}):(n=l&&l.oldAmount,c=typeof n===p?n.call(l,{hash:{},data:s}):n),f+=r(c)+'<div class="kx-special-offer-cross-out"></div></div> <span class="kx-special-offer-new-amount">'+r((n=e.i18n||l&&l.i18n,o={hash:{},data:s},n?n.call(l,"special_offer.levelup.only",o):t.call(l,"i18n","special_offer.levelup.only",o)))+" ",(n=e.newAmount)?c=n.call(l,{hash:{},data:s}):(n=l&&l.newAmount,c=typeof n===p?n.call(l,{hash:{},data:s}):n),f+=r(c)+'</span></div>\n<div class="kx-special-offer-bar-cta-button"></div>\n</div>\n<div class="kx-special-offer-bar-right-bg"></div>\n</div>\n'});}());

/* kxl-deployment-tools 2016-05-18 */

KXL.module("SpecialOfferApp.Entities",function(a,b,c){a.SpecialOffer=c.Model.extend({initialize:function(a){this.specialOfferId=a.specialOfferId},url:function(){return b.config.API_URL+"/special-offers/"+this.specialOfferId}}),a.SpecialOffersCollection=c.Collection.extend({model:a.SpecialOffer,url:function(){return b.config.API_URL+"/special-offers"}}),a.SpecialOfferEvent=c.Model.extend({url:function(){return b.config.API_URL+"/special-offer-events"}})}),KXL.module("SpecialOfferApp",function(a,b){a.OFFER_DISPLAYED_EVENT_TYPE="OFFER_DISPLAYED",a.PURCHASE_STARTED_EVENT_TYPE="PURCHASE_STARTED",a.OFFER_REDEEMED_EVENT_TYPE="OFFER_REDEEMED";var c={gameLoadHandler:function(){var d=b.request("get:current:user"),e=b.appModel.get("context");if(d.get("created")){var f=new a.Entities.SpecialOffersCollection;f.fetch({data:{active:!0,appId:e.get("id")}}).then(function(b){var e=!1;b.forEach(function(b){if(!e){var f=new a.Entities.SpecialOfferEvent;f.save({userId:d.id,specialOfferId:b.id,eventType:a.OFFER_DISPLAYED_EVENT_TYPE}).then(function(){var a=b.bonusGold,d=b.baseGold,f=a+d,g=.1;c.showSpecialOfferBar({quantity:f,baseQuantity:d,oldAmount:"$"+Math.round(f*g),newAmount:"$"+Math.round(d*g),specialOfferId:b.id}),e=!0})}})})}},showSpecialOfferBar:function(d){var d=d||{},e=new a.BarView(d);c.logSpecialOfferBiEvent(d.specialOfferId,a.OFFER_DISPLAYED_EVENT_TYPE),b.request("banner:create",{bannerId:"specialOfferBar",view:e,animate:!0,show:!0}).toggleClosable(!0)},logSpecialOfferBiEvent:function(d,e){var f="info:specialoffer:"+c.eventTypeToBiEventName[e],g=new a.Entities.SpecialOffer({specialOfferId:d}),h=b.request("current:user:game:entities")||{},i=b.appModel.get("context")||{},j=h.get(i.get("id")),k=0;j&&(k=j.get("playerId")||0),g.fetch().then(function(a){a.biAnalyticsEventGroup&&b.vent.trigger(f,a.biAnalyticsEventGroup,k)})}};c.eventTypeToBiEventName={},c.eventTypeToBiEventName[a.OFFER_DISPLAYED_EVENT_TYPE]="displayed",c.eventTypeToBiEventName[a.PURCHASE_STARTED_EVENT_TYPE]="redeemed",c.eventTypeToBiEventName[a.OFFER_REDEEMED_EVENT_TYPE]="transacted",b.vent.on("game:event:clientloadcomplete",c.gameLoadHandler),b.commands.setHandlers({"specialoffer:log:bievent":function(a,b){return c.logSpecialOfferBiEvent(a,b)}})}),KXL.module("SpecialOfferApp",function(a,b,c,d){a.BarView=d.Layout.extend({OFFER_DISPLAYED_EVENT_TYPE:"OFFER_DISPLAYED",PURCHASE_STARTED_EVENT_TYPE:"PURCHASE_STARTED",OFFER_REDEEMED_EVENT_TYPE:"OFFER_REDEEMED",template:Templates["special_offer/kx-special-offer-bar"],className:"kx-special-offer-bar",regions:{closeBtnRegion:".kx-close-btn-region",specialOfferButtonRegion:".kx-special-offer-bar-cta-button"},initialize:function(a){this.quantity=a.quantity,this.baseQuantity=a.baseQuantity,this.oldAmount=a.oldAmount,this.newAmount=a.newAmount,this.specialOfferId=a.specialOfferId},toggleCloseBtn:function(a){this.closeBtnRegion.ensureEl(),this.closeBtnRegion.$el.toggle(a)},onRender:function(){var a=this,c=new b.Components.Button.View({customClass:"kx-close-btn"});c.on("click",function(){a.trigger("close:clicked")}),a.closeBtnRegion.show(c);var d=new b.Components.Button.View({label:b.i18n.t("special_offer.levelup.get_gold"),theme:b.Components.Button.Themes.alt4o});d.on("click",function(){a.initiatePayment(a.baseQuantity,a.specialOfferId)}),a.specialOfferButtonRegion.show(d)},serializeData:function(){return{quantity:this.quantity,oldAmount:this.oldAmount,newAmount:this.newAmount}},initiatePayment:function(a,c){b.vent.trigger("payment:specialoffer:start",{blockid:-1,viewid:0,clicked:"fblgo",giftids:"",special:"kxl:special_offer:"+c,variable_cost_params:{variable_credits:a},item_info:{}},c),b.execute("specialoffer:log:bievent",this.specialOfferId,this.PURCHASE_STARTED_EVENT_TYPE),b.request("banner:hide","specialOfferBar")}})});
//# sourceMappingURL=special_offer.min.js.map